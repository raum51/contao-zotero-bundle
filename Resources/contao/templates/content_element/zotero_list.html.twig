{% extends "@Contao/content_element/_base.html.twig" %}

{% block content %}
    <div class="ce_zotero_list block">
        {% if show_reader|default(false) and reader_element_id|default(0) %}
            {# Liste + Reader kombiniert: Reader-CE rendern (News-Pattern) #}
            {{ content_element(reader_element_id) }}
        {% elseif items|length > 0 %}
            {% if token_limit_exceeded|default(false) %}
                <p class="zotero-list__token-limit-info message-info">{{ 'tl_module.zotero_search_token_limit_exceeded'|trans([token_limit|default(10)], 'contao_tl_module') }}</p>
            {% endif %}
            {% if search_mode|default(false) %}
                <p class="zotero-list__search-info">
                    {{ 'tl_module.zotero_search_results'|trans({}, 'contao_tl_module') }}{% if search_keywords|default %} „{{ search_keywords }}“{% endif %}
                </p>
            {% endif %}
            {% if total|default(0) > 0 %}
                <p class="zotero-list__total">{{ 'MSC.entries'|trans([total], 'contao_default') }}</p>
            {% endif %}
            <ul class="zotero-list__items" role="list">
                {% if groups|default and groups|length > 0 %}
                    {% for group in groups %}
                        {% set group_items = items|filter(i => (i.group_key|default) == group.key) %}
                        {% if group_items|length > 0 %}
                            <li class="zotero-list__group">
                                <strong class="zotero-list__group-label">{{ group.label|e }}</strong>
                                <ul class="zotero-list__group-items" role="list">
                                    {% for entry in group_items %}
                                        {% set item = entry.item|default(entry) %}
                                        <li class="zotero-list__item">
                                            {% if item.reader_url|default %}
                                                <a href="{{ item.reader_url }}" class="zotero-list__link">
                                                    {% include "@Contao_Raum51ContaoZoteroBundle/zotero_item/" ~ item_template ~ ".html.twig" with {item: item} %}
                                                </a>
                                            {% else %}
                                                {% include "@Contao_Raum51ContaoZoteroBundle/zotero_item/" ~ item_template ~ ".html.twig" with {item: item} %}
                                            {% endif %}
                                            {% if search_mode|default(false) and search_keywords|default and item.score is defined and item.score is not null %}
                                                <span class="zotero-list__score" title="Relevanz-Score (Test)">Gewicht: {{ item.score }}</span>
                                            {% endif %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </li>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    {% for entry in items %}
                        {% set item = entry.item|default(entry) %}
                        <li class="zotero-list__item">
                            {% if item.reader_url|default %}
                                <a href="{{ item.reader_url }}" class="zotero-list__link">
                                    {% include "@Contao_Raum51ContaoZoteroBundle/zotero_item/" ~ item_template ~ ".html.twig" with {item: item} %}
                                </a>
                            {% else %}
                                {% include "@Contao_Raum51ContaoZoteroBundle/zotero_item/" ~ item_template ~ ".html.twig" with {item: item} %}
                            {% endif %}
                            {% if search_mode|default(false) and search_keywords|default and item.score is defined and item.score is not null %}
                                <span class="zotero-list__score" title="Relevanz-Score (Test)">Gewicht: {{ item.score }}</span>
                            {% endif %}
                        </li>
                    {% endfor %}
                {% endif %}
            </ul>
            {% if pagination|default %}
                <nav class="zotero-list__pagination pagination" aria-label="{{ 'MSC.pagination'|trans({}, 'contao_default') }}">
                    <ul class="pagination__list">{{ pagination|raw }}</ul>
                </nav>
            {% endif %}
        {% elseif search_mode|default(false) %}
            {% if token_limit_exceeded|default(false) %}
                <p class="zotero-list__token-limit-info message-info">{{ 'tl_module.zotero_search_token_limit_exceeded'|trans([token_limit|default(10)], 'contao_tl_module') }}</p>
            {% endif %}
            <p class="zotero-list__no-results">{{ 'tl_module.zotero_search_no_results'|trans({}, 'contao_tl_module') }}</p>
        {% endif %}
    </div>
{% endblock %}
